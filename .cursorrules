# ExacqMan Project Rules

## Project Overview
ExacqMan is a Python video processing tool for extracting, timelapsing, and compressing surveillance videos from Exacqvision systems. The project handles video processing, API interactions, and configuration management.

## Code Style & Standards

### Python Style
- Follow PEP 8 conventions
- Use type hints for all function parameters and return values
- Use dataclasses for configuration objects
- Prefer descriptive variable names over abbreviations
- Use snake_case for functions and variables, PascalCase for classes
- Maximum line length: 88 characters (Black formatter standard)

### Documentation
- Write comprehensive docstrings for all functions and classes
- Use Google-style docstrings with Args, Returns, and Raises sections
- Include examples in docstrings when helpful
- Document complex algorithms and business logic

### Error Handling
- Use custom exception classes for domain-specific errors
- Always handle API failures gracefully with meaningful error messages
- Use try-except blocks for external API calls
- Log errors with context information

## Architecture Patterns

### Configuration Management
- Use ConfigParser for configuration files
- Implement validation for all configuration values
- Support command-line argument overrides
- Priority order: CLI args > config file > defaults

### API Integration
- Create dedicated classes for external API interactions
- Implement proper session management (login/logout)
- Use timeout handling for long-running operations
- Handle rate limiting and retries appropriately

### Video Processing
- Separate concerns: extraction, processing, compression
- Use OpenCV for video manipulation
- Implement progress tracking for long operations
- Support different output formats and qualities

## File Organization

### Core Files
- `exacqman.py`: Main application logic and CLI interface
- `exacqvision.py`: Exacqvision API integration
- `requirements.txt`: Python dependencies
- `*.config`: Configuration files for different environments

### Dependencies
- Use specific version pinning in requirements.txt
- Prefer stable, well-maintained libraries
- Keep dependencies minimal and focused

## Video Processing Guidelines

### Performance
- Use efficient video codecs (libx264 for compression)
- Implement frame skipping for timelapse effects
- Use progress bars for long-running operations
- Optimize memory usage for large video files

### Quality Settings
- Support multiple compression levels (low, medium, high)
- Implement dynamic font scaling for timestamps
- Handle different video resolutions gracefully
- Validate crop dimensions against video bounds

## API Design

### Command Line Interface
- Use argparse with subcommands for different operations
- Support both positional and optional arguments
- Provide helpful error messages and usage examples
- Validate input parameters before processing

### Configuration Files
- Use INI format for configuration files
- Organize settings into logical sections
- Validate all configuration values on startup
- Provide clear error messages for invalid configurations

## Testing & Validation

### Input Validation
- Validate all user inputs before processing
- Check file existence and permissions
- Validate date/time formats and ranges
- Ensure camera IDs and server configurations are valid

### Error Recovery
- Implement graceful degradation when possible
- Clean up temporary files and resources
- Provide clear error messages with suggested fixes
- Log important operations for debugging

## Security Considerations

### Credentials
- Store credentials in configuration files, not in code
- Use environment variables for sensitive data when possible
- Never commit credentials to version control
- Implement secure session management

### File Handling
- Validate file paths to prevent directory traversal
- Check file permissions before operations
- Clean up temporary files after processing
- Handle file system errors gracefully

## Performance Guidelines

### Memory Management
- Use context managers for file operations
- Release video resources promptly
- Implement streaming for large file downloads
- Monitor memory usage during processing

### Concurrency
- Use appropriate waiting strategies for API calls
- Implement timeout handling for long operations
- Consider async operations for I/O-bound tasks
- Use progress indicators for user feedback

## Code Quality

### Maintainability
- Write self-documenting code with clear variable names
- Break complex functions into smaller, focused functions
- Use consistent error handling patterns
- Implement proper logging throughout the application

### Extensibility
- Design for easy addition of new video processing features
- Support multiple camera systems through abstraction
- Make configuration easily extensible
- Plan for future API changes

## Development Workflow

### Version Control
- Use meaningful commit messages
- Keep commits focused and atomic
- Test changes before committing
- Use branches for feature development

### Code Review
- Review all changes before merging
- Check for security vulnerabilities
- Ensure proper error handling
- Verify performance implications

## Environment Setup

### Virtual Environment
- Always use a virtual environment for development
- Pin dependency versions in requirements.txt
- Document setup instructions in README
- Test in clean environments

### Configuration
- Provide example configuration files
- Document all configuration options
- Support multiple environment configurations
- Validate configurations on startup
